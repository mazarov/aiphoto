{
  "name": "Photo2Sticker | Bot",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "/8378545243:AAGfOT8-GczWvadCKt4XmUN1g_D8oPrHbRs/webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3760,
        160
      ],
      "id": "279518a7-ee08-4f45-8759-5545f15d6fff",
      "name": "webhook_node",
      "webhookId": "3bb33e69-0adb-4c00-abf8-4f9db6f5192c"
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"name\": \"Respond to Webhook\",\n  \"type\": \"n8n-nodes-base.respondToWebhook\",\n  \"typeVersion\": 1,\n  \"position\": [\n    500,\n    300\n  ],\n  \"parameters\": {\n    \"responseMode\": \"onReceived\",\n    \"responseCode\": 200,\n    \"responseData\": {\n      \"type\": \"json\",\n      \"json\": {\n        \"status\": \"ok\"\n      }\n    }\n  }\n}\n",
        "options": {}
      },
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.4,
      "position": [
        -3504,
        336
      ],
      "id": "20a1097f-7925-487a-9ab5-5c755a493ce6",
      "name": "respond_to_webhook"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "d10f4b00-9ae7-44dd-9425-42dd02880f76",
              "leftValue": "={{ $('webhook_node').first().json.body.message.chat.type }}",
              "rightValue": "private",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "0bff9bda-deae-4cbc-af60-241fbc21f892",
              "leftValue": "={{ $('webhook_node').first().json.body.callback_query.message.chat.type }}",
              "rightValue": "private",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "da44ff18-ff92-48ac-9f9c-428a4d3e696c",
              "leftValue": "={{ $node[\"webhook_node\"].json[\"body\"][\"pre_checkout_query\"]",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2640,
        160
      ],
      "id": "a9909afb-d83a-46a9-b9cf-6b2d1cd4e782",
      "name": "If Private Chat"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f58f6abb-a510-4684-9c80-8e3b6942ed76",
                    "leftValue": "={{ $('webhook_node').item.json.body.message.document.file_name }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "document"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "01f7438e-f2ce-48a9-80df-d917e0440b45",
                    "leftValue": "={{ $('webhook_node').item.json.body.message.poll }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "poll"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1675c3e0-cce9-425e-8990-0264816dd6a3",
                    "leftValue": "={{ $('webhook_node').first().json.body.message.video }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "video"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c43cabe-4943-42c8-89d3-71e33bc30a5e",
                    "leftValue": "={{ $('webhook_node').first().json.body.message.location }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "location"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('webhook_node').first().json.body.message.entities[0].type }}",
                    "rightValue": "bot_command",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "a0cfa5f0-1ae6-4cbd-8723-44dce6d82fbe"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "command"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "024efa7a-5f56-4f9e-b5a3-64c278f90721",
                    "leftValue": "={{ $('webhook_node').first().json.body.callback_query }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "callback"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1ab608b9-d682-4552-8c99-0fa3141b8894",
                    "leftValue": "={{ $('webhook_node').first().json.body.message }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "message"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "116b3039-fd83-4a78-8281-0ba880b146b4",
                    "leftValue": "={{ $('webhook_node').first().json.body.pre_checkout_query }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pre_checkout_query"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -1344,
        -32
      ],
      "id": "3db37ef5-566f-44a6-987f-5c23aefe83db",
      "name": "Check Event Type"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('webhook_node').first().json.body.message.text }}",
                    "rightValue": "/start",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "07826f28-faa0-40eb-a9a1-6d542df7ef84"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "start"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -1168,
        -2624
      ],
      "id": "6ec55883-659b-40be-81c6-0edc1b4b6e16",
      "name": "Check Command Type"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('webhook_node').item.json.body.callback_query.data }}",
                    "rightValue": "send_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "25372f4a-0a3b-4ebe-bf7b-b6d785c152e0"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "send_photo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "debf5059-7f99-46c0-b936-b9141abb7cd4",
                    "leftValue": "={{ $('webhook_node').item.json.body.callback_query.data }}",
                    "rightValue": "cancel",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancel"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b54a596b-c388-4faf-ac6d-58e80ed7240e",
                    "leftValue": "={{ $('webhook_node').item.json.body.callback_query.data }}",
                    "rightValue": "buy_credits",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "buy_credit"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b28f39f9-8fab-48bc-8cd4-bf1df2b2d62c",
                    "leftValue": "={{ $('webhook_node').item.json.body.callback_query.data }}",
                    "rightValue": "confirm_many_photo",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "confirm_many_photo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7f05824d-b4f3-4657-af41-e5aa0c98a89f",
                    "leftValue": "={{ $('webhook_node').item.json.body.callback_query.data }}",
                    "rightValue": "pack",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "amount_credit"
            }
          ]
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -976,
        -1312
      ],
      "id": "8552e1ea-6b9c-431b-8a26-91442700b3a7",
      "name": "Check Callback Type"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $('Set Bot Info').item.json.bot_token }}/answerPreCheckoutQuery ",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"pre_checkout_query_id\": \"{{ $node[\"webhook_node\"].json[\"body\"][\"pre_checkout_query\"][\"id\"] }}\",\n  \"ok\": true\n}\n\n",
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -144,
        144
      ],
      "id": "85908444-77f7-4d28-a272-c7620d71751c",
      "name": "send_pre_checkout_query1"
    },
    {
      "parameters": {
        "content": "## TEMP SUPERBASE\n\n### dsj7823uhHH625as"
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -3552,
        -272
      ],
      "typeVersion": 1,
      "id": "3805e890-5c04-4dc8-a006-02502a7bed1b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "71001299-2605-4664-bbe3-ccd56ea63d03",
                    "leftValue": "={{ $('webhook_node').first().json.body.message.photo }}",
                    "rightValue": "",
                    "operator": {
                      "type": "array",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "photo"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "d30ec85d-1306-477d-999f-3f75ea714689",
                    "leftValue": "={{ $('webhook_node').first().json.body.message.successful_payment.invoice_payload }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "successful_payment"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('webhook_node').first().json.body.message.text }}",
                    "rightValue": "üì∑ Done",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7bffd227-a805-4125-83d8-32ffeab1993c"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "done_en"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "cab63775-f65a-459f-988b-0a155a0ec695",
                    "leftValue": "={{ $('webhook_node').first().json.body.message.text }}",
                    "rightValue": "üì∑ –ì–æ—Ç–æ–≤–æ",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "done_ru"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "dc25c2eb-968a-4687-9d65-dd880f24d0b5",
                    "leftValue": "={{ $('webhook_node').first().json.body.message.text }}",
                    "rightValue": "‚ùå Cancel",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancel_en"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "bc28651e-ded7-40cd-9d25-d368ba1e52fb",
                    "leftValue": "={{ $('webhook_node').first().json.body.message.text }}",
                    "rightValue": "‚ùå –û—Ç–º–µ–Ω–∞‚Ä®",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "cancel_ru"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -1024,
        2576
      ],
      "id": "c966082a-9950-40b2-96a2-3ed6f0aeacd8",
      "name": "Check Message Type"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "users",
        "filters": {
          "conditions": [
            {
              "keyName": "telegram_id",
              "keyValue": "={{ $('webhook_node').first().json.body.message ? $('webhook_node').first().json.body.message.from.id : ($('webhook_node').first().json.body.callback_query ? $('webhook_node').first().json.body.callback_query.from.id : $('webhook_node').first().json.body.pre_checkout_query.from.id) }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2432,
        48
      ],
      "id": "fbf3ca43-3ec7-4f1e-938e-5d0971f26d08",
      "name": "Get User",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "5fc4c804-d1be-4fb1-b61c-8755b7cb6319",
              "leftValue": "={{ $json.telegram_id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -2240,
        48
      ],
      "id": "e2f20b4c-4688-4770-9434-6576a68162e9",
      "name": "Check User Exist"
    },
    {
      "parameters": {
        "tableId": "users",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "telegram_id",
              "fieldValue": "={{ $('webhook_node').first().json.body.message.from.id }}"
            },
            {
              "fieldId": "lang",
              "fieldValue": "={{ (($('webhook_node').first().json.body.message.from.language_code || '').toLowerCase().startsWith('ru')) ? 'ru' : 'en' }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -2064,
        144
      ],
      "id": "963db9bb-4ca8-4e42-8455-5d4580f66828",
      "name": "Create User",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e92a0845-291d-4c16-a869-10bd3c5a35d3",
              "leftValue": "={{ $('Get Active Sessions').first().json.is_active }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -960,
        -2624
      ],
      "id": "979dfdc5-2285-4b80-bf52-a07dbf2ee78a",
      "name": "If Active Session"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.id }}"
            },
            {
              "keyName": "is_active",
              "condition": "eq",
              "keyValue": "True"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').first().json.canceled }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -752,
        -2736
      ],
      "id": "92933220-e1fa-434a-b9dd-1c9ce645158b",
      "name": "Close All Session",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "5c12032e-3838-4f06-8fb8-0a21abf78ee2",
              "name": "tg_id",
              "value": "={{ $('webhook_node').first().json.body.message?.from?.id || $('webhook_node').first().json.body.callback_query?.from?.id || $('webhook_node').first().json.body.pre_checkout_query?.from?.id }}",
              "type": "string"
            },
            {
              "id": "6ef0ac14-ed72-41e3-bbc0-b8c1317c9bef",
              "name": "id",
              "value": "={{ $('Get User').first()?.json?.id || $('Create User').first()?.json?.id }}",
              "type": "string"
            },
            {
              "id": "4233bb20-8427-48fc-a5d6-548a3591123b",
              "name": "balance",
              "value": "={{ $if($('Create Transaction').isExecuted, $('Create Transaction').first().json.amount, $('Get User').first().json.credits) }}",
              "type": "string"
            },
            {
              "id": "62fca4b2-5546-4b20-8d12-5d240880a648",
              "name": "lang",
              "value": "={{ $if($('Create User').isExecuted, $('Create User').first().json.lang, $('Get User').first().json.lang) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1760,
        32
      ],
      "id": "a39d7b27-a288-478c-91f4-2e395be26848",
      "name": "User"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text\").all()[2]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        448,
        -2608
      ],
      "id": "c99684ab-bf95-480b-918a-ecdcf09014ce",
      "name": "Create Msg Text"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text').all()[0].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text').all()[0].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        640,
        -2608
      ],
      "id": "8e83b672-a3fc-4774-a31d-5f3f988a0d89",
      "name": "Send Main Msg",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=balance%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        96,
        -2608
      ],
      "id": "466912c4-d863-4a8c-9178-cce174a69455",
      "name": "Get Msg Text",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        272,
        -2608
      ],
      "id": "69e6f144-a0ca-46fe-89c9-b95c8e01b37e",
      "name": "Limit"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e92a0845-291d-4c16-a869-10bd3c5a35d3",
              "leftValue": "={{ $('Get Active Sessions').first().json.is_active }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -896,
        -2256
      ],
      "id": "4df67a56-80f3-4fd0-bf16-e4e37a016568",
      "name": "If Active Session1"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').first().json.canceled }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -688,
        -2336
      ],
      "id": "6e94332c-bf3d-43f3-ae0f-a624eea19391",
      "name": "Close All Session1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "e742d48f-9c46-4283-8dd2-8fa404f9276e",
              "name": "open",
              "value": "open",
              "type": "string"
            },
            {
              "id": "7097f701-d7f7-46f5-aaf5-9e174ae6be19",
              "name": "wait_photo",
              "value": "wait_photo",
              "type": "string"
            },
            {
              "id": "00f074e0-6269-43db-9711-77f718196e09",
              "name": "many_photo",
              "value": "many_photo",
              "type": "string"
            },
            {
              "id": "0bcbe537-a78b-47a0-a494-33d3a85c2994",
              "name": "wait_buy_credit",
              "value": "wait_buy_credit",
              "type": "string"
            },
            {
              "id": "8f2f099e-3899-44a9-857d-840022b6d288",
              "name": "wait_description",
              "value": "wait_description",
              "type": "string"
            },
            {
              "id": "f2f13c3f-a25d-4e3b-95a9-7e29d46a24b3",
              "name": "processing",
              "value": "processing",
              "type": "string"
            },
            {
              "id": "45a0351a-3ca0-48a7-bdcf-14aeefaa6966",
              "name": "done",
              "value": "done",
              "type": "string"
            },
            {
              "id": "a8694047-7f0a-4df3-8709-ce2d61ef5fa0",
              "name": "canceled",
              "value": "canceled",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3072,
        160
      ],
      "id": "c5f73db1-2809-4df6-896d-79886a45e0f7",
      "name": "Set Session State"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=photos%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -320,
        -2240
      ],
      "id": "879d9472-b971-4c22-a119-6397df3e2b50",
      "name": "Get Msg Text1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text1').all()[0].json.text }}",
        "replyMarkup": "replyKeyboard",
        "replyKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text1').all()[1].json.text }}",
                    "additionalFields": {}
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text1').all()[0].json.text }}",
                    "additionalFields": {}
                  }
                ]
              }
            }
          ]
        },
        "replyKeyboardOptions": {
          "resize_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        400,
        -2240
      ],
      "id": "d19afc1a-b2f6-4fc3-a678-fec4ce199dd9",
      "name": "Send Main Msg1",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        112,
        -2240
      ],
      "id": "16930662-bb6d-4997-a765-da71b23c7182",
      "name": "Limit1"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text1\").all()[3]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        -2240
      ],
      "id": "6ee5a1a4-91a9-4111-9bdb-d72f5aea7f22",
      "name": "Create Msg Text1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e92a0845-291d-4c16-a869-10bd3c5a35d3",
              "leftValue": "={{ $('Get Active Sessions').first().json.is_active }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -240,
        5120
      ],
      "id": "327d73d0-84e3-43e7-8c02-22ffd4cab093",
      "name": "If Active Session2"
    },
    {
      "parameters": {
        "tableId": "sessions",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $('User').first().json.id }}"
            },
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_photo }}"
            },
            {
              "fieldId": "is_active",
              "fieldValue": "True"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -496,
        -2240
      ],
      "id": "71cfdcd8-a322-45f6-8bd2-924dfcbf05de",
      "name": "Create Session",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text2\").all()[2]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        416,
        5136
      ],
      "id": "7a6fd035-4a2f-4c4e-94ce-34d60280d1da",
      "name": "Create Msg Text2"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text2').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text2').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text2').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text2').all()[0].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text2').all()[0].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        672,
        5136
      ],
      "id": "a8d1c005-e4ec-49c8-a86b-1fb056c2ccc2",
      "name": "Send Main Msg2",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').item.json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=balance%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        112,
        5136
      ],
      "id": "d226b72b-c0fc-4d7c-8896-769d39682cb1",
      "name": "Get Msg Text2",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        272,
        5136
      ],
      "id": "a60e535d-414c-45c4-ad23-935facc9fd9f",
      "name": "Limit2"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text Remove Photo').all()[0].json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        672,
        4832
      ],
      "id": "ff9a153d-edc5-4bae-a884-f1335d7f952a",
      "name": "Send Main Msg3",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').item.json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=remove_photo%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        432,
        4832
      ],
      "id": "ec188a64-ac41-4d16-a688-2a7b624cdf14",
      "name": "Get Msg Text Remove Photo",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e92a0845-291d-4c16-a869-10bd3c5a35d3",
              "leftValue": "={{ $('Get Active Sessions').first().json.is_active }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -304,
        560
      ],
      "id": "1daf60de-d710-4544-843b-64b5d73b8d9e",
      "name": "If Active Session3"
    },
    {
      "parameters": {
        "tableId": "sessions",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $('User').first().json.id }}"
            },
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_photo }}"
            },
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').first().json.canceled }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -112,
        640
      ],
      "id": "a523a098-79a4-47dc-a407-17d1e3449c02",
      "name": "Create Session1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ session_photos\ncurrent_photos_raw = _(\"Edit Session Field\").first().json.get('session_photos')\n\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã: null, \"[]\", —Å—Ç—Ä–æ–∫–∞ —Å –º–∞—Å—Å–∏–≤–æ–º, –º–∞—Å—Å–∏–≤\nif current_photos_raw is None or current_photos_raw == \"[]\" or current_photos_raw == []:\n    current_photos = []\nelif isinstance(current_photos_raw, str):\n    current_photos = eval(current_photos_raw)\nelse:\n    # –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ\n    current_photos = list(current_photos_raw) if current_photos_raw else []\n\n# –ü–æ–ª—É—á–∞–µ–º –º–∞—Å—Å–∏–≤ —Ñ–æ—Ç–æ –∏–∑ webhook –Ω–æ–¥—ã\nphotos = _(\"webhook_node\").first().json['body']['message']['photo']\n\n# –ù–∞—Ö–æ–¥–∏–º —Ñ–æ—Ç–æ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º file_size\nlargest_photo = max(photos, key=lambda x: x['file_size'])\n\n# –î–æ–±–∞–≤–ª—è–µ–º file_id\ncurrent_photos.append(largest_photo['file_id'])\n\n# –í–æ–∑–≤—Ä–∞—â–∞–µ–º\nreturn [{'json': {'photos': current_photos}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        272,
        544
      ],
      "id": "f572b064-c64b-4203-ad01-a050189f3d8b",
      "name": "Add Photo"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e92a0845-291d-4c16-a869-10bd3c5a35d3",
              "leftValue": "={{ $('Get Active Sessions').item.json.is_active }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -272,
        3216
      ],
      "id": "ff50a0d8-d977-4eff-b0a9-785cb62c0c1d",
      "name": "If Active Session4"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º session –∏–∑ input\nsession = _input.first().json\n\n# –ü–æ–ª—É—á–∞–µ–º photos –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º null\nphotos = session.get('photos')\nif photos is None or photos == \"[]\":\n    photos_count = 0\nelif isinstance(photos, str):\n    photos_count = len(eval(photos))\nelse:\n    photos_count = len(list(photos)) if photos else 0\n\n# –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ\nreturn [{'json': {'count': photos_count}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        16,
        3200
      ],
      "id": "e2251649-11c1-48d6-a264-daf42003c509",
      "name": "Check Photo Count"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ Number($('Check Photo Count').first().json.count) }}",
                    "rightValue": 0,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "031d649d-8cc8-4271-af8c-00c3a08dc725"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "count=0"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3c3a129a-5492-48a3-8199-49ebe81b0c05",
                    "leftValue": "={{ Number($('Check Photo Count').first().json.count) }}",
                    "rightValue": 10,
                    "operator": {
                      "type": "number",
                      "operation": "gt"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "count>10"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        240,
        3184
      ],
      "id": "ac898c3a-3d8a-48f9-a7ed-c5cf1934e3a8",
      "name": "Switch"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').first().json.canceled }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        464,
        2592
      ],
      "id": "18dc688b-3dbb-4e27-b78a-50a6e0417c3f",
      "name": "Close All Session3",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text3\").all()[2]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1120,
        2816
      ],
      "id": "e82e24d9-0728-458a-9b5c-57c7312989d6",
      "name": "Create Msg Text3"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=balance%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        784,
        2816
      ],
      "id": "f7517fc4-fa7d-47f8-bda4-6e50375a8e8c",
      "name": "Get Msg Text3",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        640,
        2592
      ],
      "id": "5e479c92-d5f0-4e9e-89c9-477a073418f6",
      "name": "Limit3"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "eq",
              "keyValue": "=errors.no_photos"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        928,
        2528
      ],
      "id": "dc7965e3-5943-4a7b-9725-39813298960a",
      "name": "Get Msg Text4",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text4').first().json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1360,
        2528
      ],
      "id": "591b2d11-61c6-4b2b-a7e6-37515deaffa4",
      "name": "Send Main Msg5",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -1568,
        912
      ],
      "id": "4c1d2a96-3edf-4ea8-ad69-5ff1327e5e58",
      "name": "Event Not Supported"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text5').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text5').all()[2].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text5').all()[2].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text5').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text5').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1024,
        3360
      ],
      "id": "92c72dfc-4cfd-47f4-9db9-565f93c20626",
      "name": "Send Main Msg6",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=errors.many_photos_2%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        608,
        3360
      ],
      "id": "5477dd5e-ea0c-48c7-9caa-9cbd5a29728e",
      "name": "Get Msg Text5",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        768,
        3360
      ],
      "id": "4a58c281-7c7f-469a-a7d7-214c61d46ac7",
      "name": "Limit4"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "eq",
              "keyValue": "=errors.many_photos_1"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        752,
        3088
      ],
      "id": "e49658c3-772f-4236-ae20-d7acabf886f2",
      "name": "Get Msg Text6",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text6').first().json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1008,
        3088
      ],
      "id": "6c4a2795-0c70-43b0-bc64-40dd92c06627",
      "name": "Send Main Msg7",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f85fb698-bf2e-4b6f-bb58-f75f92d6ffbd",
              "name": "session_photos",
              "value": "={{ $if($('Get Active Sessions').isExecuted, $('Get Active Sessions').first().json.photos, $('Create Session1').first().json.photos) }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        96,
        544
      ],
      "id": "1a55689a-2f01-4a49-a4ac-82ca345071f4",
      "name": "Edit Session Field"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e92a0845-291d-4c16-a869-10bd3c5a35d3",
              "leftValue": "={{ $('Get Active Sessions').item.json.is_active }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -736,
        -384
      ],
      "id": "16d4fb7b-b51d-48f0-b11c-2f6208f57299",
      "name": "If Active Session5"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ë–µ—Ä–µ–º –º–∞—Å—Å–∏–≤ photos –∏–∑ session\nphotos = _input.first().json['photos']\n\n# –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 10 —ç–ª–µ–º–µ–Ω—Ç–æ–≤\nphotos_trimmed = photos[:10]\n\n# –í–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—Å—Å–∏–≤\nreturn [{'json': {'photos': photos_trimmed}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -560,
        -384
      ],
      "id": "c774c2e5-c31a-4a9f-8095-5382bc6a0e5f",
      "name": "Limit Photos To Ten"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "837350c0-9b7a-44f4-9d16-fcc77238aae7",
              "leftValue": "={{ $('Limit Photos To Ten').first().json.photos.length }}",
              "rightValue": "={{ $('User').first().json.balance.toNumber() }}",
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -224,
        -240
      ],
      "id": "1ab22ce3-fd21-48ea-ad8f-710492d2b0ed",
      "name": "Has Enough Balance?"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "sessions",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.id }}"
            },
            {
              "keyName": "is_active",
              "condition": "eq",
              "keyValue": "True"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1520,
        32
      ],
      "id": "1df5517f-bf0b-4b42-8a80-4dd981e7428f",
      "name": "Get Active Sessions",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id || $('Create Session1').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "photos",
              "fieldValue": "={{ $('Add Photo').first().json.photos }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        448,
        544
      ],
      "id": "3d4c4f91-1c57-45b8-915e-4fe4895661c3",
      "name": "Add Photo To Session",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').first().json.many_photo }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        448,
        3200
      ],
      "id": "9b5b33d2-2036-4189-b45f-f7ffa727216f",
      "name": "Update Session State (many_photo)",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_description }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        64,
        -480
      ],
      "id": "f92c5095-70fd-4e33-8d5d-5fe30a6dc0c1",
      "name": "Update Session State (wait_description)",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=style%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        256,
        -480
      ],
      "id": "613c0510-11b7-466b-949d-71801c001015",
      "name": "Get Msg Text7",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text7').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text7').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text7').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        720,
        -480
      ],
      "id": "5ba0272e-9d0c-4b89-afd2-d700228fb06c",
      "name": "Send Main Msg8",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        448,
        -480
      ],
      "id": "9e62f10a-b216-4feb-a4c5-1e68f7d333d3",
      "name": "Limit5"
    },
    {
      "parameters": {
        "content": "# Command\n## /start\n# Supabase ‚úÖ\n# New User ‚úÖ\n# Old user ‚úÖ\n",
        "height": 576,
        "width": 2240,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1424,
        -2256
      ],
      "typeVersion": 1,
      "id": "e5094c31-9d84-47cd-8436-bdd34a54e046",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "# Callback\n## Send Photo",
        "height": 304,
        "width": 1648,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1216,
        -2368
      ],
      "typeVersion": 1,
      "id": "b88438ae-5b65-485f-b588-3c0aa347258b",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "# Callback\n## Confirm Many Photos",
        "height": 752,
        "width": 2096,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1216,
        -672
      ],
      "typeVersion": 1,
      "id": "da2115b1-bfeb-4f5d-b50f-4f02877b9de0",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "content": "# Message\n## Photo",
        "height": 304,
        "width": 1200,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -736,
        496
      ],
      "typeVersion": 1,
      "id": "3e44e93a-162d-4ce9-a8ba-6ecbea503c27",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "content": "# Message\n## Cancel",
        "height": 544,
        "width": 1424,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -768,
        4768
      ],
      "typeVersion": 1,
      "id": "cf27b3de-40ca-4888-9dcb-b1407d85d981",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "content": "# Message\n## Done",
        "height": 2288,
        "width": 2464,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -768,
        2448
      ],
      "typeVersion": 1,
      "id": "051deea7-6eb5-48dd-a89c-6af887676daa",
      "name": "Sticky Note6"
    },
    {
      "parameters": {
        "content": "# User Send 0 Photos",
        "height": 528,
        "width": 1392,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        16,
        2464
      ],
      "typeVersion": 1,
      "id": "6ea7c270-4b68-45d8-b51f-09b532259b94",
      "name": "Sticky Note7"
    },
    {
      "parameters": {
        "content": "# User Send >10 Photos",
        "height": 544,
        "width": 1136,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        16,
        3008
      ],
      "typeVersion": 1,
      "id": "80f077c4-1eec-4e6d-adc2-d8cbcaf70064",
      "name": "Sticky Note8"
    },
    {
      "parameters": {
        "content": "# Pre-checkout Message",
        "height": 304,
        "width": 1056,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1216,
        112
      ],
      "typeVersion": 1,
      "id": "49a09f34-4c2b-46e8-b303-8b049e63fb0e",
      "name": "Sticky Note9"
    },
    {
      "parameters": {
        "content": "# User Send 1- 10 Photos",
        "height": 1136,
        "width": 1616,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        32,
        3568
      ],
      "typeVersion": 1,
      "id": "5d5701b3-0a2b-4410-a5f0-6eeba73c399d",
      "name": "Sticky Note10"
    },
    {
      "parameters": {
        "content": "# Message\n## Succesful Message",
        "height": 1568,
        "width": 3136,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -752,
        832
      ],
      "typeVersion": 1,
      "id": "41b3c763-3518-4187-be70-a600e5428612",
      "name": "Sticky Note11"
    },
    {
      "parameters": {
        "content": "# Callback\n## Amount Stars",
        "height": 352,
        "width": 1760,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1216,
        -1056
      ],
      "typeVersion": 1,
      "id": "3598a87b-50a8-476e-ab99-5e47db0eacda",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "content": "# Callback\n## Cancel",
        "height": 576,
        "width": 1408,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1216,
        -2032
      ],
      "typeVersion": 1,
      "id": "32bae1f1-f5b3-455d-a569-ddc7fbad04cc",
      "name": "Sticky Note13"
    },
    {
      "parameters": {
        "content": "# Callback\n## Buy Credit",
        "height": 352,
        "width": 1216,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1216,
        -1424
      ],
      "typeVersion": 1,
      "id": "dfcde073-dcb5-464d-8288-f99765b24633",
      "name": "Sticky Note14"
    },
    {
      "parameters": {
        "content": "# Message\n## Sticker Description",
        "height": 528,
        "width": 2336,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -768,
        5344
      ],
      "typeVersion": 1,
      "id": "8679b10c-b2bc-40b4-bd55-22dd5288bc84",
      "name": "Sticky Note15"
    },
    {
      "parameters": {
        "content": "# User Enough Balance",
        "height": 320,
        "width": 1008,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -240,
        -640
      ],
      "typeVersion": 1,
      "id": "1a415fd2-d830-42dc-ae82-f5e8f2451b32",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "content": "# User Not Enough Balance",
        "height": 368,
        "width": 1120,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -256,
        -304
      ],
      "typeVersion": 1,
      "id": "50eb3a23-f873-4f69-96b7-2e8b6055a2a5",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "837350c0-9b7a-44f4-9d16-fcc77238aae7",
              "leftValue": "={{ $('Get Active Sessions').first().json.photos.length }}",
              "rightValue": "={{ $('User').first().json.balance.toNumber() }}",
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        416,
        4096
      ],
      "id": "0b2eeaaa-b75a-486f-8b63-07bb39e33c82",
      "name": "Has Enough Balance?1"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_description }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        720,
        3760
      ],
      "id": "eb1a6895-a4f8-4af3-9656-31d7a3d6b689",
      "name": "Update Session State (wait_description)1",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=style%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        928,
        3952
      ],
      "id": "fbd00942-399e-40e4-bace-3ff627cd2384",
      "name": "Get Msg Text8",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text8').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text8').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text8').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1616,
        3952
      ],
      "id": "ca2a1c7b-3c9c-4140-bba0-5a0c9b8a1eb0",
      "name": "Send Main Msg9",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1104,
        3952
      ],
      "id": "0e7fac0b-6dca-44da-92ef-54aa13886651",
      "name": "Limit6"
    },
    {
      "parameters": {
        "content": "# User Enough Balance",
        "height": 560,
        "width": 1184,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        448,
        3568
      ],
      "typeVersion": 1,
      "id": "251e33e2-c1e0-4426-b915-deeb6444fa71",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "content": "# User Not Enough Balance",
        "height": 512,
        "width": 1200,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        432,
        4160
      ],
      "typeVersion": 1,
      "id": "192b1d1b-ccd3-4c1b-8181-83b58e7f5622",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=credits%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        928,
        4496
      ],
      "id": "3186f3ea-c031-45d8-b0a3-ea3a7163e031",
      "name": "Get Msg Text9",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1120,
        4496
      ],
      "id": "cc24cb64-f348-48c2-8da6-9c1fee1f66e2",
      "name": "Limit7"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_buy_credit }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        720,
        4368
      ],
      "id": "af64b90a-745a-42e3-bb8b-dd7ac4c7ec62",
      "name": "Update Session State (wait_buy_credit)",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text9\").all()[6]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        4496
      ],
      "id": "166dac4b-dd6f-4b24-9e5b-87976adbb1bf",
      "name": "Create Msg Text5"
    },
    {
      "parameters": {
        "content": "üíé Your balance: XX credits‚Ä®‚Ä®1 credit = 1 sticker‚Ä®‚Ä®Maximum sticker pack size ‚Äî 10 stickers.\nButtons:‚Ä®\nüì∑ Send photo‚Ä®\nüåü Buy credits\n# Message ‚úÖ",
        "height": 336,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        432,
        -2800
      ],
      "typeVersion": 1,
      "id": "f04b266d-eed5-4c0e-8814-f109b56991ce",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "Send from 1 to 10 photos and tap Done.\n‚Ä®üì∏ Your balance: XX credits‚Ä® \n1 credit = 1 sticker\n\nReply keyboard:\nüì∑  Done‚Ä®\nüåü  Cancel\n\n\n\n\n# Message ‚úÖ",
        "height": 272,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        64,
        -2352
      ],
      "typeVersion": 1,
      "id": "d003b3fc-12f0-456b-b98f-e5571c7ee7f3",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "content": "‚ú® Now describe the sticker style you want to get \nExamples: anime / comic / cartoon / realistic / pixel art‚Ä®‚Ä®\nYou can also add emotions or details: cute, angry, glasses, text, etc.\n\n–ö–Ω–æ–ø–∫–∏:\n‚ùå Cancel\n\n\n\n\n\n# Message ‚úÖ",
        "height": 288,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        384,
        -624
      ],
      "typeVersion": 1,
      "id": "1dd3eee8-58f1-4fc0-9167-3fb18dbb9336",
      "name": "Sticky Note22"
    },
    {
      "parameters": {
        "content": "‚ö†Ô∏è You didn‚Äôt send any photos.\n# Message ‚úÖ",
        "height": 256,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1024,
        2432
      ],
      "typeVersion": 1,
      "id": "2cd1cb56-3e49-48a5-96ef-c3bbcfae6731",
      "name": "Sticky Note23"
    },
    {
      "parameters": {
        "content": "üíé Your balance: XX credits‚Ä®‚Ä®1 credit = 1 sticker‚Ä®‚Ä®Maximum sticker pack size ‚Äî 10 stickers.\nButtons:‚Ä®\nüì∑ Send photo‚Ä®\nüåü Buy credits\n\n\n\n\n\n\n\n# Message ‚úÖ",
        "height": 256,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1024,
        2720
      ],
      "typeVersion": 1,
      "id": "77053a8c-fe1e-470f-9ab8-be4483892514",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "content": "‚ö†Ô∏è You sent more than 10 photos.\n# Message ‚úÖ",
        "height": 208,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        688,
        3024
      ],
      "typeVersion": 1,
      "id": "9d2e7678-5773-42e7-91d3-a7c130ee0d37",
      "name": "Sticky Note25"
    },
    {
      "parameters": {
        "content": "The sticker pack will be created only from the first 10.\nIf you want to change the set of photos ‚Äî tap Cancel and upload them again.\n\nButtons:‚Ä® \n‚úÖ Confirm‚Ä® \n‚ùå Cancel\n\n\n\n\n\n\n# Message ‚úÖ",
        "height": 304,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        688,
        3248
      ],
      "typeVersion": 1,
      "id": "50602184-fb4a-4b5b-b64c-d4d64a3ad5a7",
      "name": "Sticky Note26"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text3').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text3').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text3').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text3').all()[0].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text3').all()[0].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1360,
        2816
      ],
      "id": "0dfeaf66-1926-4195-be29-8a3ac5cc1f76",
      "name": "Send Main Msg4",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "content": "‚ú® Now describe the sticker style you want to get \nExamples: anime / comic / cartoon / realistic / pixel art‚Ä®‚Ä®\nYou can also add emotions or details: cute, angry, glasses, text, etc.\n\n–ö–Ω–æ–ø–∫–∏:\n‚ùå Cancel\n\n\n\n\n\n# Message ‚úÖ",
        "height": 304,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1280,
        3808
      ],
      "typeVersion": 1,
      "id": "b431e83d-76b3-4f32-bc2c-12853c40ca6e",
      "name": "Sticky Note27"
    },
    {
      "parameters": {
        "content": "üòï  Not enough credits to generate a sticker.\nYou currently have {credits} credits.‚Ä® \nPlease top up your balance ‚Äî 1 sticker = 1 credit.\n\nButtons:‚Ä® \n2 ‚Äî 15‚≠ê \n5 ‚Äî 30‚≠ê \n10 ‚Äî 60‚≠ê  \n20 ‚Äî 100‚≠ê \n‚ùå Cancel\n\n\n# Message ‚úÖ",
        "height": 320,
        "width": 320,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1296,
        4384
      ],
      "typeVersion": 1,
      "id": "1b379835-d609-4885-9db1-922bd8686497",
      "name": "Sticky Note28"
    },
    {
      "parameters": {
        "content": "All photos have been deleted.\n# Message ‚úÖ",
        "height": 272,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        400,
        4720
      ],
      "typeVersion": 1,
      "id": "08384650-c851-4899-b377-4c9c414ca9ca",
      "name": "Sticky Note29"
    },
    {
      "parameters": {
        "content": "üíé Your balance: XX credits‚Ä®‚Ä®1 credit = 1 sticker‚Ä®‚Ä®\nMaximum sticker pack size ‚Äî 10 stickers.\n\nButtons:‚Ä® \nüì∑ Send photo‚Ä® \nüåü Buy credits\n\n\n\n\n\n# Message ‚úÖ",
        "height": 272,
        "width": 304,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        336,
        5024
      ],
      "typeVersion": 1,
      "id": "eb2b3c35-1cf8-4f99-871e-0845c3e84ffd",
      "name": "Sticky Note30"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        960,
        2816
      ],
      "id": "646297de-da15-4a1b-9ddb-6cedb81fc5a4",
      "name": "Limit8"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').first().json.canceled }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -64,
        4992
      ],
      "id": "34f1d079-0a71-4044-96b8-6b9c3a972415",
      "name": "Close Active Session",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text8\").first()['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        3952
      ],
      "id": "404a1297-0879-4091-a556-c770008e331a",
      "name": "Create Msg Text6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e92a0845-291d-4c16-a869-10bd3c5a35d3",
              "leftValue": "={{ $('Get Active Sessions').first().json.is_active }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -864,
        -1680
      ],
      "id": "e690048f-fe78-4d50-85f0-810904d99be6",
      "name": "If Active Session6"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text10\").all()[2]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -48,
        -1664
      ],
      "id": "17430530-0af2-44fb-afd7-95f9a04cf8df",
      "name": "Create Msg Text7"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text7').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text10').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text10').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text10').all()[0].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text10').all()[0].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        208,
        -1664
      ],
      "id": "6ea1cea8-f011-422f-86f9-16c3ff9b34f8",
      "name": "Send Main Msg11",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').item.json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=balance%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -448,
        -1664
      ],
      "id": "421e6d69-3cbf-4686-a77a-eb06c0c5aaaa",
      "name": "Get Msg Text10",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -240,
        -1664
      ],
      "id": "71a91d0b-054e-4290-b54e-9f83abbcbc27",
      "name": "Limit9"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text Remove Photo1').all()[0].json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        192,
        -1952
      ],
      "id": "e2be7034-3021-4aac-a10f-e20892ec6582",
      "name": "Send Main Msg12",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "mMSW9rkKzn7hhWUj",
          "name": "@test1_sticker_bot"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').item.json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=remove_photo%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -32,
        -1936
      ],
      "id": "dc91ae53-b470-4d8a-a1d3-bbf97e4393a3",
      "name": "Get Msg Text Remove Photo1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "content": "All photos have been deleted.\n# Message ‚úÖ",
        "height": 240,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -80,
        -2032
      ],
      "typeVersion": 1,
      "id": "890e5c4e-dd1e-4c64-93f9-5913d29f95c4",
      "name": "Sticky Note31"
    },
    {
      "parameters": {
        "content": "üíé Your balance: XX credits‚Ä®‚Ä®1 credit = 1 sticker‚Ä®‚Ä®\nMaximum sticker pack size ‚Äî 10 stickers.\n\nButtons:‚Ä® \nüì∑ Send photo‚Ä® \nüåü Buy credits\n\n\n\n\n\n# Message ‚úÖ",
        "height": 320,
        "width": 304,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -128,
        -1776
      ],
      "typeVersion": 1,
      "id": "30ceedf2-3b0f-439b-9820-b1f5193c0b7c",
      "name": "Sticky Note32"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').first().json.canceled }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -640,
        -1808
      ],
      "id": "8f24e2a7-d38a-4fd8-b0c9-d04a6674de5c",
      "name": "Close Active Session1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -336,
        5728
      ],
      "id": "e7a2c521-1e90-43be-a7da-6d86ca467dcd",
      "name": "IGNORE"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "e92a0845-291d-4c16-a869-10bd3c5a35d3",
              "leftValue": "={{ $('Get Active Sessions').item.json.state }}",
              "rightValue": "={{ $('Set Session State').item.json.wait_description }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -464,
        5568
      ],
      "id": "faea4501-eff3-4213-92a3-a0a4f3e603c0",
      "name": "If Session State Is wait_description"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').item.json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=style.received"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        880,
        5424
      ],
      "id": "20f4f93e-3659-4c5a-83cb-fb404cb0b4c3",
      "name": "Get Msg Text11",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text11\").first()['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ü–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ\nphotos_count = len(_(\"Get Active Sessions\").first()['json']['photos'])\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º {{N}} –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π\nresult_text = result_text.replace(\"{{N}}\", str(photos_count))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1072,
        5424
      ],
      "id": "d59e94a6-1867-4ce7-a27d-5c6262ef7e24",
      "name": "Create Msg Text8"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text8').first().json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        352,
        6080
      ],
      "id": "bb0323af-d72a-447d-a144-1006160fde75",
      "name": "Send Main Msg13",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "QivmD5ZDxWlqttW1",
          "name": "Telegram account"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "‚úÖ Great, the style is set!\n‚Ä®I‚Äôm starting to create {N} stickers in your style \n‚ú®‚Ä®‚Ä®Please wait a few seconds ‚Äî preparing the magic ü§ñ‚ú®",
        "height": 288,
        "width": 304,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        256,
        5968
      ],
      "typeVersion": 1,
      "id": "2a1d932c-b8e0-44b2-a8e6-e6031b551a7f",
      "name": "Sticky Note33"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "prompt_final",
              "fieldValue": "={{ $('Check User Input + Create User Prompt').first().json.output.prompt }}"
            },
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.processing }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        688,
        5424
      ],
      "id": "81b0941b-0af1-4248-80f9-d22121872c6e",
      "name": "Add Stickers Description And Update State (processing)",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=credits%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        240,
        -128
      ],
      "id": "58497d7d-911a-4ebc-81cc-50ea357d0c63",
      "name": "Get Msg Text12",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        432,
        -128
      ],
      "id": "fbe36efe-99b1-4ec2-845a-3fdcfc4f3acc",
      "name": "Limit10"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_buy_credit }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        32,
        -128
      ],
      "id": "f62edf58-b396-42ff-97cd-8788e97e7f83",
      "name": "Update Session State (wait_buy_credit)1",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text12\").all()[6]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        608,
        -128
      ],
      "id": "1b8f97f5-5b3f-4a07-b851-b9fd2e423c7a",
      "name": "Create Msg Text9"
    },
    {
      "parameters": {
        "content": "üòï  Not enough credits to generate a sticker.\nYou currently have {credits} credits.‚Ä® \nPlease top up your balance ‚Äî 1 sticker = 1 credit.\n\nButtons:‚Ä® \n2 ‚Äî 15‚≠ê \n5 ‚Äî 30‚≠ê \n10 ‚Äî 60‚≠ê  \n20 ‚Äî 100‚≠ê \n‚ùå Cancel\n\n\n\n\n# Message ‚úÖ",
        "height": 320,
        "width": 320,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        544,
        -272
      ],
      "typeVersion": 1,
      "id": "501e1c31-890b-4496-84f2-3cdef9e93b75",
      "name": "Sticky Note34"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "photos",
              "fieldValue": "={{ $('Limit Photos To Ten').first().json.photos }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -384,
        -384
      ],
      "id": "b660a663-b1bf-4cc1-affb-afc5f593af48",
      "name": "Update Photo List",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c3f377cf-f22c-46b5-a5cc-6420ea8cf1d0",
              "name": "created",
              "value": "created",
              "type": "string"
            },
            {
              "id": "7a824e66-3eb2-4423-ba68-9c4cb39618d7",
              "name": "processed",
              "value": "processed",
              "type": "string"
            },
            {
              "id": "b33ef2fd-26b8-41c6-bbbd-f53f04769415",
              "name": "done",
              "value": "done",
              "type": "string"
            },
            {
              "id": "e843dc50-f717-4d1a-8af6-e10dab6b0fb1",
              "name": "canceled",
              "value": "canceled",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2864,
        160
      ],
      "id": "f3ca11e4-4a22-4292-90a0-4640a376bfca",
      "name": "Set Transaction State"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').item.json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=credits%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -704,
        -1296
      ],
      "id": "2332d202-9fb7-42c5-a7af-72a8dc2609cd",
      "name": "Get Msg Text13",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text13\").all()[0]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -336,
        -1296
      ],
      "id": "bef4d251-6a8c-4c2e-8738-6690a6974335",
      "name": "Create Msg Text10"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text10').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text13').all()[3].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text13').all()[3].json.cb_data }}"
                    }
                  },
                  {
                    "text": "={{ $('Get Msg Text13').all()[5].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text13').all()[5].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text13').all()[2].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text13').all()[2].json.cb_data }}"
                    }
                  },
                  {
                    "text": "={{ $('Get Msg Text13').all()[4].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text13').all()[4].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text13').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text13').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -32,
        -1296
      ],
      "id": "2cf600e9-de63-43c4-9b4d-f0bf2b2149de",
      "name": "Send Main Msg15",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "content": "üí≥ Your balance‚Ä® \nYou currently have {credits} credits.‚Ä® \n1 sticker = 1 credit.‚Ä® \nIf you need more ‚Äî top up your balance using Telegram Stars üí´\n‚Ä®Buttons:‚Ä® \n2 ‚Äî 15‚≠ê  \n5 ‚Äî 30‚≠ê  \n10 ‚Äî 60‚≠ê  \n20 ‚Äî 100‚≠ê\n‚ùå Cancel\n\n# Message ‚úÖ",
        "height": 320,
        "width": 352,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -400,
        -1408
      ],
      "typeVersion": 1,
      "id": "cea6e3b5-6e06-4164-b9f9-de4211f105ed",
      "name": "Sticky Note35"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -528,
        -1296
      ],
      "id": "ad638e8a-a60b-4bba-9c54-f0aee9593eed",
      "name": "Limit11"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.telegram.org/bot{{ $('Set Bot Info').first().json.bot_token }}/sendInvoice",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"chat_id\": \"{{ $('User').first().json.tg_id }}\",\n  \"title\": \"Your credites\",\n  \"description\": \"Payment for Credites\",\n  \"provider_token\": \"{{ $('Get Msg Text14').first().json.text }}\",\n  \"payload\": \"[{{ $('Create New Transaction').first().json.id }}]\",\n  \"currency\": \"XTR\",\n  \"prices\": [\n    { \"label\": \"Credites\", \"amount\": {{ $('Get Data From Cb').first().json.pack_price }} }\n  ],\n  \"start_parameter\": \"Credites\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        480,
        -944
      ],
      "id": "80503582-241c-44d1-85a3-225bc3ea2539",
      "name": "send_invoice1",
      "retryOnFail": true
    },
    {
      "parameters": {
        "tableId": "transactions",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $json.id }}"
            },
            {
              "fieldId": "amount",
              "fieldValue": "1"
            },
            {
              "fieldId": "price",
              "fieldValue": "0"
            },
            {
              "fieldId": "state",
              "fieldValue": "done"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -1904,
        144
      ],
      "id": "c07fcf96-07a3-43c8-9731-d77356baa9f7",
      "name": "Create Transaction",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "payment%"
            },
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        32,
        -944
      ],
      "id": "966b6ca8-84b8-4524-a00d-513025bcb728",
      "name": "Get Msg Text14",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text5').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text9').all()[3].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text9').all()[3].json.cb_data }}"
                    }
                  },
                  {
                    "text": "={{ $('Get Msg Text9').all()[5].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text9').all()[5].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text9').all()[2].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text9').all()[2].json.cb_data }}"
                    }
                  },
                  {
                    "text": "={{ $('Get Msg Text9').all()[4].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text9').all()[4].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text9').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text9').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1648,
        4496
      ],
      "id": "836263f7-701b-483a-9812-13b5ce825cb0",
      "name": "Send Main Msg16",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text9').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text12').all()[3].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text12').all()[3].json.cb_data }}"
                    }
                  },
                  {
                    "text": "={{ $('Get Msg Text12').all()[5].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text12').all()[5].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text12').all()[2].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text12').all()[2].json.cb_data }}"
                    }
                  },
                  {
                    "text": "={{ $('Get Msg Text12').all()[4].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text12').all()[4].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text12').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text12').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -128
      ],
      "id": "adea7c33-4771-4de0-b5df-e775f71a1c15",
      "name": "Send Main Msg17",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        240,
        -944
      ],
      "id": "555c4f01-02a0-4c75-b4ab-1e491aada781",
      "name": "Limit12"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "transactions",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "keyValue": "={{ $('User').first().json.id }}"
            },
            {
              "keyName": "is_active",
              "keyValue": "true"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -816,
        -944
      ],
      "id": "91aca1d5-4327-4d3a-91d5-13c42ab8817b",
      "name": "Get Open Transactions",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "transactions",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Transaction State').item.json.canceled }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -592,
        -944
      ],
      "id": "62b3b2a2-dac2-4144-8228-6921fb651c7b",
      "name": "Close Old Transactions",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "tableId": "transactions",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "user_id",
              "fieldValue": "={{ $('User').first().json.id }}"
            },
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Transaction State').first().json.created }}"
            },
            {
              "fieldId": "is_active",
              "fieldValue": "true"
            },
            {
              "fieldId": "amount",
              "fieldValue": "={{ $('Get Data From Cb').first().json.pack_number }}"
            },
            {
              "fieldId": "price",
              "fieldValue": "={{ $('Get Data From Cb').first().json.pack_price }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -160,
        -944
      ],
      "id": "2a580cc0-7e18-43b5-a21a-2cc51418379c",
      "name": "Create New Transaction",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º invoice_payload –∏–∑ webhook\ninvoice_payload = _(\"webhook_node\").first()['json']['body']['pre_checkout_query']['invoice_payload']\n\n# –£–±–∏—Ä–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏\ntransaction_id = invoice_payload.strip('[]')\n\n# –í–æ–∑–≤—Ä–∞—â–∞–µ–º\nreturn [{'json': {'transaction_id': transaction_id}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -944,
        240
      ],
      "id": "a86ee717-dd2c-4204-9bab-7ea35403eec9",
      "name": "Get TransactionId From TgPayload"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "84693a48-85ff-4887-9ec8-16e79a28a9f5",
              "leftValue": "={{ $('Get Transaction').first().json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -544,
        240
      ],
      "id": "12324546-5adb-4f0a-b419-ce463701bd29",
      "name": "If"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "transactions",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get TransactionId From TgPayload').first().json.transaction_id }}"
            },
            {
              "keyName": "state",
              "condition": "eq",
              "keyValue": "={{ $('Set Transaction State').first().json.created }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -752,
        240
      ],
      "id": "e8c582f3-0113-49ff-b9ca-d42d113cf9bf",
      "name": "Get Transaction",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "content": "# ERROR.COMMON",
        "height": 304,
        "width": 416,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2480,
        288
      ],
      "typeVersion": 1,
      "id": "f11798b5-1d7e-4491-8f23-e4ee036e08fc",
      "name": "Sticky Note36"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "transactions",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get TransactionId From TgPayload').first().json.transaction_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Transaction State').first().json.processed }}"
            },
            {
              "fieldId": "pre_checkout_query_id",
              "fieldValue": "={{ $('webhook_node').first().json.body.pre_checkout_query.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -336,
        144
      ],
      "id": "061adf52-941a-49d5-8ecd-82531cedd2d6",
      "name": "Update Transaction State (Processed)",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º invoice_payload –∏–∑ webhook\ninvoice_payload = _(\"webhook_node\").first()['json']['body']['message']['successful_payment']['invoice_payload']\n\n# –£–±–∏—Ä–∞–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏\ntransaction_id = invoice_payload.strip('[]')\n\n# –í–æ–∑–≤—Ä–∞—â–∞–µ–º\nreturn [{'json': {'transaction_id': transaction_id}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -400,
        2096
      ],
      "id": "3779929a-a62b-49fe-8cd3-c49947c1cdc9",
      "name": "Get TransactionId From TgPayload1"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "transactions",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get TransactionId From TgPayload1').first().json.transaction_id }}"
            },
            {
              "keyName": "state",
              "condition": "eq",
              "keyValue": "={{ $('Set Transaction State').first().json.processed }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -208,
        2096
      ],
      "id": "1a2ad4e4-b2d0-4bba-9ae1-720b5399738d",
      "name": "Get Transaction1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º callback_data\ncallback_data = _(\"webhook_node\").first()['json']['body']['callback_query']['data']\n# –†–∞–∑–±–∏–≤–∞–µ–º –ø–æ \"_\"\nparts = callback_data.split(\"_\")\n# –ò–∑–≤–ª–µ–∫–∞–µ–º —á–∏—Å–ª–∞\npack_number = int(parts[1])\npack_price = int(parts[2])\n# –í–æ–∑–≤—Ä–∞—â–∞–µ–º\nreturn [{'json': {'pack_number': pack_number, 'pack_price': pack_price}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -368,
        -944
      ],
      "id": "30aff7a2-c53d-461a-b2c9-dfb11db6190a",
      "name": "Get Data From Cb"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "84693a48-85ff-4887-9ec8-16e79a28a9f5",
              "leftValue": "={{ $('Get Transaction1').first().json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        0,
        2096
      ],
      "id": "62aa0154-9304-4672-b1ef-08136195165f",
      "name": "If Transaction Exist"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "48e9bbf4-c6a9-4bf4-9bd9-bf1aefb4e9b1",
              "leftValue": "={{ $('Get Active Sessions').first().json.id }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        688,
        1984
      ],
      "id": "6025b2d1-2d19-4da8-b28e-2045e32c6066",
      "name": "If Session Exist",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "transactions",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get TransactionId From TgPayload1').first().json.transaction_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Transaction State').first().json.done }}"
            },
            {
              "fieldId": "telegram_payment_charge_id",
              "fieldValue": "={{ $('webhook_node').first().json.body.message.successful_payment.telegram_payment_charge_id }}"
            },
            {
              "fieldId": "provider_payment_charge_id",
              "fieldValue": "={{ $('webhook_node').first().json.body.message.successful_payment.provider_payment_charge_id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        208,
        1984
      ],
      "id": "5f8d4620-1c18-4a6b-bdfa-73e139064db3",
      "name": "Update Transaction State (Done)",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_description }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1840,
        2640
      ],
      "id": "35fa1bda-ee2d-420a-bc60-13639cbdf648",
      "name": "Update Session State (wait_description)2",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=style%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2048,
        2640
      ],
      "id": "4f59f474-df6d-459d-959c-6b519d9daea3",
      "name": "Get Msg Text15",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text15').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text15').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text15').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2592,
        2640
      ],
      "id": "357d64a2-94ff-468f-b722-99478500be01",
      "name": "Send Main Msg10",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "mMSW9rkKzn7hhWUj",
          "name": "@test1_sticker_bot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        2224,
        2640
      ],
      "id": "434cb8df-ff98-40b2-9c43-839be44a7510",
      "name": "Limit13"
    },
    {
      "parameters": {
        "content": "‚ú® Now describe the sticker style you want to get \nExamples: anime / comic / cartoon / realistic / pixel art‚Ä®‚Ä®\nYou can also add emotions or details: cute, angry, glasses, text, etc.\n\n–ö–Ω–æ–ø–∫–∏:\n‚ùå Cancel\n\n\n\n\n\n\n\n\n\n# Message ‚úÖ",
        "height": 352,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2432,
        2480
      ],
      "typeVersion": 1,
      "id": "6786b12e-7d3e-4c70-9e15-75802c1eb913",
      "name": "Sticky Note37"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text16\").all()[2]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"Get User1\").first()['json']['credits']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1296,
        2128
      ],
      "id": "03f0eb00-0fd4-4d9b-baab-74c1882c11e5",
      "name": "Create Msg Text12"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text12').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text16').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text16').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text16').all()[0].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text16').all()[0].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1600,
        2128
      ],
      "id": "a3d2b037-c0dd-47e8-9146-3308660a7e81",
      "name": "Send Main Msg14",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=balance%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        944,
        2128
      ],
      "id": "22e5c728-2902-4941-9766-76958e3212dc",
      "name": "Get Msg Text16",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1120,
        2128
      ],
      "id": "1847668d-9b76-407a-a1b9-1d257e05a3fd",
      "name": "Limit14"
    },
    {
      "parameters": {
        "content": "üíé Your balance: XX credits‚Ä®‚Ä®1 credit = 1 sticker‚Ä®‚Ä®Maximum sticker pack size ‚Äî 10 stickers.\nButtons:‚Ä®\nüì∑ Send photo‚Ä®\nüåü Buy credits\n\n\n\n\n\n\n\n# Message ‚úÖ",
        "height": 352,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1328,
        2032
      ],
      "typeVersion": 1,
      "id": "f8b6fa33-1b89-4036-b13c-59726c0fdad2",
      "name": "Sticky Note38"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "eq",
              "keyValue": "=photos.received"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1104,
        3648
      ],
      "id": "fe68fad9-7aa2-4b8e-ad00-45c6305cc756",
      "name": "Get Msg Text17",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text4').first().json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1584,
        3648
      ],
      "id": "e7edfaef-d789-4b7f-a724-945f4c1df667",
      "name": "Send Main Msg18",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "content": "You have sent {{XX}} photos\n# Message ‚úÖ",
        "height": 256,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1280,
        3536
      ],
      "typeVersion": 1,
      "id": "830e5ed6-5415-476f-8dd0-91cb80a2f4d1",
      "name": "Sticky Note40"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "template = _(\"Get Msg Text17\").first()['json']['text']\nphotos_count = len(_(\"Get Active Sessions\").first()['json']['photos'])\nresult_text = template.replace(\"{{XX}}\", str(photos_count))\nreturn [{'json': {'text': result_text}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1312,
        3648
      ],
      "id": "0ec1d398-d9e7-49d0-b37a-9fe6973867da",
      "name": "Create Msg Text4"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "eq",
              "keyValue": "=photos.received"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1088,
        4240
      ],
      "id": "4f8de2f3-2699-42a8-9c81-2f9d56cd238c",
      "name": "Get Msg Text18",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text13').first().json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1616,
        4240
      ],
      "id": "5bb154d6-f417-4fa5-86e5-5df4928a63c6",
      "name": "Send Main Msg19",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "content": "You have sent {{XX}} photos\n# Message ‚úÖ",
        "height": 224,
        "width": 320,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1296,
        4160
      ],
      "typeVersion": 1,
      "id": "dd58775a-c6ea-45cd-ad06-90ed16a8f672",
      "name": "Sticky Note41"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "template = _(\"Get Msg Text18\").first()['json']['text']\nphotos_count = len(_(\"Get Active Sessions\").first()['json']['photos'])\nresult_text = template.replace(\"{{XX}}\", str(photos_count))\nreturn [{'json': {'text': result_text}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1296,
        4240
      ],
      "id": "aaaeed5e-1694-4f7e-9d83-dac19948aece",
      "name": "Create Msg Text13"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=remove_photo%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -400,
        -2736
      ],
      "id": "49243559-f196-40ab-8c69-77f7eaa22f49",
      "name": "Get Msg Text19",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        -576,
        -2736
      ],
      "id": "d50358a8-05d4-48f1-a5cb-204cbe9e29d4",
      "name": "Limit15"
    },
    {
      "parameters": {
        "chatId": "={{ $('Get User').first().json.telegram_id }}",
        "text": "={{ $('Get Msg Text19').first().json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -192,
        -2736
      ],
      "id": "d04ba73d-b52e-442f-b435-975e2e24fe95",
      "name": "Send a text message",
      "webhookId": "0c29ab67-d856-4032-87d4-f61b4d983381",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "content": "# –í–´–ó–û–í –í–û–†–ö–§–õ–û–£ –ì–ï–ù–ï–†–ê–¶–ò–ò –°–¢–ò–ö–ï–†–ü–ê–ö–ê\n",
        "height": 304,
        "width": 512,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1248,
        5376
      ],
      "typeVersion": 1,
      "id": "1cd69747-8d23-4016-b053-8284c8a6d1b6",
      "name": "Sticky Note39"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "=–û—à–∏–±–∫–∞",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2608,
        384
      ],
      "id": "25e939c8-fdab-4663-8995-dd89b334d32f",
      "name": "Send Main Msg21",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "content": "# IGNORE. Event Not Supported",
        "height": 320,
        "width": 416,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -1936,
        784
      ],
      "typeVersion": 1,
      "id": "47245204-2a26-4862-93e2-c8e6e1428136",
      "name": "Sticky Note42"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "7jXYjyhv3nlNhyEC",
          "mode": "list",
          "cachedResultUrl": "/workflow/7jXYjyhv3nlNhyEC",
          "cachedResultName": "Photo2Sticker | Processing"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "={{ $('User').first().json.id }}",
            "session_id": "={{ $('Get Active Sessions').first().json.id }}",
            "bot_username": "={{ $('Set Bot Info').first().json.bot_username }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "bot_token",
              "displayName": "bot_token",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": true
            },
            {
              "id": "bot_username",
              "displayName": "bot_username",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": true,
          "convertFieldsToString": true
        },
        "options": {}
      },
      "type": "n8n-nodes-base.executeWorkflow",
      "typeVersion": 1.3,
      "position": [
        1632,
        5488
      ],
      "id": "e578d2dd-6e50-4a35-9f0c-a7de880cc742",
      "name": "Call 'Photo2Sticker | Processing'"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "dbc51243-f9b3-46c6-9172-969ffb8f76dd",
              "name": "bot_token",
              "value": "={{ $('Get Bot Data').first().json.token }}",
              "type": "string"
            },
            {
              "id": "1d597a89-02f8-4073-9754-bbd14e42c793",
              "name": "bot_username",
              "value": "={{ $('Get Bot Data').first().json.username}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3296,
        160
      ],
      "id": "8000af55-4fea-453a-82e1-261bbc692197",
      "name": "Set Bot Info"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "4023be15-d702-4b45-b7d2-8dff03ba1460",
              "leftValue": "={{ $('Check User Input + Create User Prompt').first().json.output.ok }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        256,
        5440
      ],
      "id": "e881a5c3-01b4-48af-a524-4d18a1d53cfd",
      "name": "If1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('webhook_node').first().json.body.message.text }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "={{ $('Get Agent Data').first().json.prompt }}"
            },
            {
              "type": "HumanMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[0].human }}"
            },
            {
              "type": "AIMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[0].ai }}"
            },
            {
              "type": "HumanMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[1].human }}"
            },
            {
              "type": "AIMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[1].ai }}"
            },
            {
              "type": "HumanMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[2].human }}"
            },
            {
              "type": "AIMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[2].ai }}"
            },
            {
              "type": "HumanMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[3].human }}"
            },
            {
              "type": "AIMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[3].ai }}"
            },
            {
              "type": "HumanMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[4].human }}"
            },
            {
              "type": "AIMessagePromptTemplate",
              "message": "={{ JSON.parse($('Get Agent Data').first().json.few_short)[4].ai }}"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -32,
        5440
      ],
      "id": "915123bf-a252-45de-9b05-3374ebf1e9cc",
      "name": "Check User Input + Create User Prompt"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text8').first().json.text }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1360,
        5504
      ],
      "id": "907f4496-7b88-48ee-9656-09bb65ddbeed",
      "name": "Send a text message1",
      "webhookId": "be97b0bf-c714-4eae-a194-be6bc8671182",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').item.json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').first().json.processing }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        480,
        5424
      ],
      "id": "3b7f9ec8-134b-424b-98e4-2e1d3c81dae4",
      "name": "Update Session State (processing)",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "style%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        480,
        5664
      ],
      "id": "5c52f76b-e9fd-468d-badd-f1ce3905c4a9",
      "name": "Get msg text",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get msg text').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get msg text').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get msg text').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        912,
        5664
      ],
      "id": "1d555c5c-ea1a-4897-aea0-999f03b23a55",
      "name": "Send a text message2",
      "webhookId": "be97b0bf-c714-4eae-a194-be6bc8671182",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        688,
        5664
      ],
      "id": "e77cb0d4-ed61-44aa-916a-ae0f78849370",
      "name": "Limit16"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "users",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "keyValue": "={{ $('User').item.json.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        416,
        1984
      ],
      "id": "2c7875d1-492f-4e64-aa06-a8b3e3f6bfed",
      "name": "Get User1",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\"type\": \"object\",\n\"properties\": {\n\"ok\": {\n\"type\": \"boolean\"\n},\n\"prompt\": {\n\"type\": [\"string\", \"null\"]\n},\n\"retry\": {\n\"type\": \"boolean\"\n}\n},\n\"required\": [\"ok\", \"retry\"],\n\"additionalProperties\": false\n}",
        "autoFix": true
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [
        112,
        5664
      ],
      "id": "4bdc4bf2-11df-4eaa-b703-9cf005f3d7aa",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "modelName": "models/gemini-3-flash-preview",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -32,
        5712
      ],
      "id": "0843d96b-a589-4453-a2f4-bfb648a2992e",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "Sx93g4N43RHoyrT7",
          "name": "Photo2Sticker_Gemini (Max)"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "837350c0-9b7a-44f4-9d16-fcc77238aae7",
              "leftValue": "={{ $('Get Active Sessions').first().json.photos.length }}",
              "rightValue": "={{ $('Get User1').first().json.credits }}",
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1024,
        1440
      ],
      "id": "75c1638c-dbe0-46e7-b5a2-d581898c7229",
      "name": "Has Enough Balance?2"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_description }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1328,
        1104
      ],
      "id": "3aaa82da-277e-4aab-8fdd-cf55835b0121",
      "name": "Update Session State (wait_description)3",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=style%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1536,
        1296
      ],
      "id": "b587c80f-ca84-4254-b4e1-214b79ca8459",
      "name": "Get Msg Text21",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Get Msg Text21').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text21').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text21').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2224,
        1296
      ],
      "id": "9efda13e-450a-445f-ac19-13df7b6ccea7",
      "name": "Send Main Msg20",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1712,
        1296
      ],
      "id": "83c35568-d5e5-46a4-9ef1-fce8f9e3708c",
      "name": "Limit17"
    },
    {
      "parameters": {
        "content": "# User Enough Balance",
        "height": 560,
        "width": 1184,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1056,
        912
      ],
      "typeVersion": 1,
      "id": "0916c0e1-94cd-4c8e-85ab-552f0d440274",
      "name": "Sticky Note43"
    },
    {
      "parameters": {
        "content": "# User Not Enough Balance",
        "height": 512,
        "width": 1200,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1040,
        1504
      ],
      "typeVersion": 1,
      "id": "37f87b96-a2aa-48b7-86e3-a17f886b8174",
      "name": "Sticky Note44"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "like",
              "keyValue": "=credits%"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1536,
        1840
      ],
      "id": "ba35ead7-7e55-4802-a091-a8116bfc92ed",
      "name": "Get Msg Text22",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.limit",
      "typeVersion": 1,
      "position": [
        1728,
        1840
      ],
      "id": "7976905c-19e0-4c38-bdea-7071182871d9",
      "name": "Limit18"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "sessions",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $('Get Active Sessions').first().json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "state",
              "fieldValue": "={{ $('Set Session State').item.json.wait_buy_credit }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1328,
        1712
      ],
      "id": "b9feee1d-b165-491c-aeb9-c348279b5657",
      "name": "Update Session State (wait_buy_credit)2",
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text22\").all()[6]['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1936,
        1840
      ],
      "id": "d48a8a75-0c7a-4270-b9ff-46d0ce53e1a6",
      "name": "Create Msg Text11"
    },
    {
      "parameters": {
        "content": "‚ú® Now describe the sticker style you want to get \nExamples: anime / comic / cartoon / realistic / pixel art‚Ä®‚Ä®\nYou can also add emotions or details: cute, angry, glasses, text, etc.\n\n–ö–Ω–æ–ø–∫–∏:\n‚ùå Cancel\n\n\n\n\n\n# Message ‚úÖ",
        "height": 304,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1888,
        1152
      ],
      "typeVersion": 1,
      "id": "a4843df1-84c3-4455-b951-d5a72a774032",
      "name": "Sticky Note45"
    },
    {
      "parameters": {
        "content": "üòï  Not enough credits to generate a sticker.\nYou currently have {credits} credits.‚Ä® \nPlease top up your balance ‚Äî 1 sticker = 1 credit.\n\nButtons:‚Ä® \n2 ‚Äî 15‚≠ê \n5 ‚Äî 30‚≠ê \n10 ‚Äî 60‚≠ê  \n20 ‚Äî 100‚≠ê \n‚ùå Cancel\n\n\n# Message ‚úÖ",
        "height": 320,
        "width": 320,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1904,
        1728
      ],
      "typeVersion": 1,
      "id": "386fdc28-d14d-4835-8754-bc929e73e753",
      "name": "Sticky Note46"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –Ω–æ–¥—ã Get Msg Text\ntemplate = _(\"Get Msg Text21\").first()['json']['text']\n# –ü–æ–ª—É—á–∞–µ–º balance –∏–∑ –Ω–æ–¥—ã User\nuser_balance = _(\"User\").first()['json']['balance']\n# –ó–∞–º–µ–Ω—è–µ–º {{credits}} –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ\nresult_text = template.replace(\"{{credits}}\", str(user_balance))\n# –ó–∞–º–µ–Ω—è–µ–º \\n –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫\nresult_text = result_text.replace('\\\\n', '\\n')\n# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥–Ω—ã–µ items\nfor item in _input.all():\n    item['json']['text'] = result_text\nreturn _input.all()"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1936,
        1296
      ],
      "id": "a4b43100-2fa4-48ec-a61f-e534899f23c1",
      "name": "Create Msg Text14"
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text11').all()[0].json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text22').all()[3].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text22').all()[3].json.cb_data }}"
                    }
                  },
                  {
                    "text": "={{ $('Get Msg Text22').all()[5].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text22').all()[5].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text22').all()[2].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text22').all()[2].json.cb_data }}"
                    }
                  },
                  {
                    "text": "={{ $('Get Msg Text22').all()[4].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text22').all()[4].json.cb_data }}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "={{ $('Get Msg Text22').all()[1].json.text }}",
                    "additionalFields": {
                      "callback_data": "={{ $('Get Msg Text22').all()[1].json.cb_data }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2256,
        1840
      ],
      "id": "4f349cce-4697-4c68-8fe7-e41cf56ec4c9",
      "name": "Send Main Msg22",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "eq",
              "keyValue": "=photos.received"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1712,
        992
      ],
      "id": "333df073-c45d-4eaa-88da-f34039ef4218",
      "name": "Get Msg Text23",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text15').first().json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2192,
        992
      ],
      "id": "206d9f37-b709-4fd8-8c72-c590b55732aa",
      "name": "Send Main Msg23",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "content": "You have sent {{XX}} photos\n# Message ‚úÖ",
        "height": 256,
        "width": 352,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1888,
        880
      ],
      "typeVersion": 1,
      "id": "1c07166b-fda2-4516-8ffa-8541dc3e756b",
      "name": "Sticky Note47"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "template = _(\"Get Msg Text23\").first()['json']['text']\nphotos_count = len(_(\"Get Active Sessions\").first()['json']['photos'])\nresult_text = template.replace(\"{{XX}}\", str(photos_count))\nreturn [{'json': {'text': result_text}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1920,
        992
      ],
      "id": "18dd2d68-c8bd-404b-a88a-d1f7e09d7d73",
      "name": "Create Msg Text15"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "bot_texts",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "keyName": "lang",
              "condition": "eq",
              "keyValue": "={{ $('User').first().json.lang }}"
            },
            {
              "keyName": "key",
              "condition": "eq",
              "keyValue": "=photos.received"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1696,
        1584
      ],
      "id": "953aee5e-7ea7-44a3-868a-b88d6318122a",
      "name": "Get Msg Text24",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "R7tgFzFM71oEYwVs",
          "name": "Supabase account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('User').first().json.tg_id }}",
        "text": "={{ $('Create Msg Text16').first().json.text }}",
        "replyMarkup": "replyKeyboardRemove",
        "replyKeyboardRemove": {
          "remove_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2224,
        1584
      ],
      "id": "246ad416-cbc2-447c-b3d3-7da421cac4f1",
      "name": "Send Main Msg24",
      "webhookId": "ab202021-6a37-4bff-ac1d-eaf0cb6c69c2",
      "credentials": {
        "telegramApi": {
          "id": "XMzesfTQuSFn9crC",
          "name": "@Photo_2_StickerBot"
        }
      }
    },
    {
      "parameters": {
        "content": "You have sent {{XX}} photos\n# Message ‚úÖ",
        "height": 224,
        "width": 320,
        "color": 2
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1904,
        1504
      ],
      "typeVersion": 1,
      "id": "f2cc8c6d-58d4-4b44-a8f7-bb472dcf37c5",
      "name": "Sticky Note48"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "template = _(\"Get Msg Text24\").first()['json']['text']\nphotos_count = len(_(\"Get Active Sessions\").first()['json']['photos'])\nresult_text = template.replace(\"{{XX}}\", str(photos_count))\nreturn [{'json': {'text': result_text}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1904,
        1584
      ],
      "id": "ad2dd80d-2dc4-450a-af39-aee48548166a",
      "name": "Create Msg Text16"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "LeMjWjy0G6oC3pep",
          "mode": "list",
          "cachedResultName": "Agents",
          "cachedResultUrl": "/projects/kIb3KG1jOzb7y7Fs/datatables/LeMjWjy0G6oC3pep"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "workflow",
              "keyValue": "Photo2Sticker | Bot"
            },
            {
              "keyName": "agent",
              "keyValue": "Check User Input + Create User Prompt"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -208,
        5440
      ],
      "id": "8fd7e38c-b825-40de-b1f3-cb4b2f654017",
      "name": "Get Agent Data"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "={{ $json.model }}",
          "mode": "id"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        -80,
        6160
      ],
      "id": "68e1c2a2-a47a-465a-9d71-b85f53d6a439",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "nfeU2ZTfogDhJAmr",
          "name": "OpenAi (Max)"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "KyuNqmSgGqX2xZQ6",
          "mode": "list",
          "cachedResultName": "bots",
          "cachedResultUrl": "/projects/kIb3KG1jOzb7y7Fs/datatables/KyuNqmSgGqX2xZQ6"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "project",
              "keyValue": "Photo2Sticker"
            },
            {
              "keyName": "username",
              "keyValue": "Photo_2_StickerBot"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -3504,
        160
      ],
      "id": "68536f71-cf1d-401a-8dcc-19ab60ad45de",
      "name": "Get Bot Data"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1",
          "mode": "list",
          "cachedResultName": "gpt-4.1"
        },
        "builtInTools": {},
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.3,
      "position": [
        64,
        6064
      ],
      "id": "367fe7ee-d6c1-4767-b664-89d780baa69a",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "nfeU2ZTfogDhJAmr",
          "name": "OpenAi (Max)"
        }
      }
    },
    {
      "parameters": {
        "modelName": "models/gemini-3-flash-preview",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        112,
        5904
      ],
      "id": "e9803003-de4f-4ca1-8a96-0be8f9ed6615",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "Sx93g4N43RHoyrT7",
          "name": "Photo2Sticker_Gemini (Max)"
        }
      }
    }
  ],
  "pinData": {
    "webhook_node": [
      {
        "json": {
          "headers": {
            "host": "1877-yvaz-rym6.gw-1a.dockhost.net",
            "connection": "close",
            "x-real-ip": "91.108.5.144",
            "content-length": "488",
            "accept-encoding": "gzip, deflate",
            "content-type": "application/json",
            "x-forwarded-for": "91.108.5.144",
            "x-forwarded-host": "1877-yvaz-rym6.gw-1a.dockhost.net",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https"
          },
          "params": {},
          "query": {},
          "body": {
            "update_id": 617212068,
            "message": {
              "message_id": 656,
              "from": {
                "id": 5102838218,
                "is_bot": false,
                "first_name": "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä",
                "last_name": "–ú—É—Ç–µ–≤",
                "username": "shushlon",
                "language_code": "en"
              },
              "chat": {
                "id": 5102838218,
                "first_name": "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä",
                "last_name": "–ú—É—Ç–µ–≤",
                "username": "shushlon",
                "type": "private"
              },
              "date": 1768823782,
              "text": "–∞–Ω–∏–º–µ"
            }
          },
          "webhookUrl": "https://1877-yvaz-rym6.gw-1a.dockhost.net/webhook/8378545243:AAGfOT8-GczWvadCKt4XmUN1g_D8oPrHbRs/webhook",
          "executionMode": "production"
        }
      }
    ]
  },
  "connections": {
    "webhook_node": {
      "main": [
        [
          {
            "node": "respond_to_webhook",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Bot Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Private Chat": {
      "main": [
        [
          {
            "node": "Get User",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Event Not Supported",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Event Type": {
      "main": [
        [
          {
            "node": "Event Not Supported",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Event Not Supported",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Event Not Supported",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Event Not Supported",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Command Type",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Callback Type",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Check Message Type",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get TransactionId From TgPayload",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Event Not Supported",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Command Type": {
      "main": [
        [
          {
            "node": "If Active Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Callback Type": {
      "main": [
        [
          {
            "node": "If Active Session1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Active Session6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Msg Text13",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Active Session5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Open Transactions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User": {
      "main": [
        [
          {
            "node": "Check User Exist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check User Exist": {
      "main": [
        [
          {
            "node": "User",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create User": {
      "main": [
        [
          {
            "node": "Create Transaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Active Session": {
      "main": [
        [
          {
            "node": "Close All Session",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Msg Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Close All Session": {
      "main": [
        [
          {
            "node": "Limit15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "User": {
      "main": [
        [
          {
            "node": "Get Active Sessions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text": {
      "main": [
        [
          {
            "node": "Send Main Msg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text": {
      "main": [
        [
          {
            "node": "Limit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit": {
      "main": [
        [
          {
            "node": "Create Msg Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Active Session1": {
      "main": [
        [
          {
            "node": "Close All Session1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Close All Session1": {
      "main": [
        [
          {
            "node": "Create Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Session State": {
      "main": [
        [
          {
            "node": "Set Transaction State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text1": {
      "main": [
        [
          {
            "node": "Create Msg Text1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit1": {
      "main": [
        [
          {
            "node": "Send Main Msg1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text1": {
      "main": [
        [
          {
            "node": "Limit1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Active Session2": {
      "main": [
        [
          {
            "node": "Close Active Session",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Msg Text2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Message Type": {
      "main": [
        [
          {
            "node": "If Active Session3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get TransactionId From TgPayload1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Active Session4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Active Session4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Active Session2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Active Session2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If Session State Is wait_description",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Session": {
      "main": [
        [
          {
            "node": "Get Msg Text1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text2": {
      "main": [
        [
          {
            "node": "Send Main Msg2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text2": {
      "main": [
        [
          {
            "node": "Limit2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit2": {
      "main": [
        [
          {
            "node": "Create Msg Text2",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Msg Text Remove Photo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Main Msg3": {
      "main": [
        []
      ]
    },
    "Get Msg Text Remove Photo": {
      "main": [
        [
          {
            "node": "Send Main Msg3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Active Session3": {
      "main": [
        [
          {
            "node": "Edit Session Field",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Create Session1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Session1": {
      "main": [
        [
          {
            "node": "Edit Session Field",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Photo": {
      "main": [
        [
          {
            "node": "Add Photo To Session",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Active Session4": {
      "main": [
        [
          {
            "node": "Check Photo Count",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Main Msg21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Photo Count": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Close All Session3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Session State (many_photo)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Has Enough Balance?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Close All Session3": {
      "main": [
        [
          {
            "node": "Limit3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text3": {
      "main": [
        [
          {
            "node": "Send Main Msg4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text3": {
      "main": [
        [
          {
            "node": "Limit8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit3": {
      "main": [
        [
          {
            "node": "Get Msg Text4",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Msg Text3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text4": {
      "main": [
        [
          {
            "node": "Send Main Msg5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text5": {
      "main": [
        [
          {
            "node": "Limit4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit4": {
      "main": [
        [
          {
            "node": "Send Main Msg6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text6": {
      "main": [
        [
          {
            "node": "Send Main Msg7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Session Field": {
      "main": [
        [
          {
            "node": "Add Photo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Active Session5": {
      "main": [
        [
          {
            "node": "Limit Photos To Ten",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Main Msg21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit Photos To Ten": {
      "main": [
        [
          {
            "node": "Update Photo List",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Enough Balance?": {
      "main": [
        [
          {
            "node": "Update Session State (wait_description)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Session State (wait_buy_credit)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Active Sessions": {
      "main": [
        [
          {
            "node": "Check Event Type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (many_photo)": {
      "main": [
        [
          {
            "node": "Get Msg Text5",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Msg Text6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (wait_description)": {
      "main": [
        [
          {
            "node": "Get Msg Text7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit5": {
      "main": [
        [
          {
            "node": "Send Main Msg8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text7": {
      "main": [
        [
          {
            "node": "Limit5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Has Enough Balance?1": {
      "main": [
        [
          {
            "node": "Update Session State (wait_description)1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Session State (wait_buy_credit)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (wait_description)1": {
      "main": [
        [
          {
            "node": "Get Msg Text8",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Msg Text17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text8": {
      "main": [
        [
          {
            "node": "Limit6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit6": {
      "main": [
        [
          {
            "node": "Create Msg Text6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text9": {
      "main": [
        [
          {
            "node": "Limit7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit7": {
      "main": [
        [
          {
            "node": "Create Msg Text5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (wait_buy_credit)": {
      "main": [
        [
          {
            "node": "Get Msg Text9",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Msg Text18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text5": {
      "main": [
        [
          {
            "node": "Send Main Msg16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit8": {
      "main": [
        [
          {
            "node": "Create Msg Text3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Close Active Session": {
      "main": [
        [
          {
            "node": "Get Msg Text2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text6": {
      "main": [
        [
          {
            "node": "Send Main Msg9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Active Session6": {
      "main": [
        [
          {
            "node": "Close Active Session1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Msg Text10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text7": {
      "main": [
        [
          {
            "node": "Send Main Msg11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text10": {
      "main": [
        [
          {
            "node": "Limit9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit9": {
      "main": [
        [
          {
            "node": "Create Msg Text7",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Msg Text Remove Photo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text Remove Photo1": {
      "main": [
        [
          {
            "node": "Send Main Msg12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Close Active Session1": {
      "main": [
        [
          {
            "node": "Get Msg Text10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Session State Is wait_description": {
      "main": [
        [
          {
            "node": "Get Agent Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IGNORE",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text11": {
      "main": [
        [
          {
            "node": "Create Msg Text8",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text8": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Stickers Description And Update State (processing)": {
      "main": [
        [
          {
            "node": "Get Msg Text11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text12": {
      "main": [
        [
          {
            "node": "Limit10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit10": {
      "main": [
        [
          {
            "node": "Create Msg Text9",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (wait_buy_credit)1": {
      "main": [
        [
          {
            "node": "Get Msg Text12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text9": {
      "main": [
        [
          {
            "node": "Send Main Msg17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Photo List": {
      "main": [
        [
          {
            "node": "Has Enough Balance?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Transaction State": {
      "main": [
        [
          {
            "node": "If Private Chat",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text13": {
      "main": [
        [
          {
            "node": "Limit11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text10": {
      "main": [
        [
          {
            "node": "Send Main Msg15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit11": {
      "main": [
        [
          {
            "node": "Create Msg Text10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Transaction": {
      "main": [
        [
          {
            "node": "User",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text14": {
      "main": [
        [
          {
            "node": "Limit12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit12": {
      "main": [
        [
          {
            "node": "send_invoice1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Open Transactions": {
      "main": [
        [
          {
            "node": "Close Old Transactions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Close Old Transactions": {
      "main": [
        [
          {
            "node": "Get Data From Cb",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create New Transaction": {
      "main": [
        [
          {
            "node": "Get Msg Text14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get TransactionId From TgPayload": {
      "main": [
        [
          {
            "node": "Get Transaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Update Transaction State (Processed)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Main Msg21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Transaction": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Transaction State (Processed)": {
      "main": [
        [
          {
            "node": "send_pre_checkout_query1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get TransactionId From TgPayload1": {
      "main": [
        [
          {
            "node": "Get Transaction1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Transaction1": {
      "main": [
        [
          {
            "node": "If Transaction Exist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Data From Cb": {
      "main": [
        [
          {
            "node": "Create New Transaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Transaction Exist": {
      "main": [
        [
          {
            "node": "Update Transaction State (Done)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send Main Msg21",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Transaction State (Done)": {
      "main": [
        [
          {
            "node": "Get User1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (wait_description)2": {
      "main": [
        [
          {
            "node": "Get Msg Text15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text15": {
      "main": [
        [
          {
            "node": "Limit13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit13": {
      "main": [
        [
          {
            "node": "Send Main Msg10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Session Exist": {
      "main": [
        [
          {
            "node": "Has Enough Balance?2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Msg Text16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text12": {
      "main": [
        [
          {
            "node": "Send Main Msg14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text16": {
      "main": [
        [
          {
            "node": "Limit14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit14": {
      "main": [
        [
          {
            "node": "Create Msg Text12",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text17": {
      "main": [
        [
          {
            "node": "Create Msg Text4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text4": {
      "main": [
        [
          {
            "node": "Send Main Msg18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text18": {
      "main": [
        [
          {
            "node": "Create Msg Text13",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text13": {
      "main": [
        [
          {
            "node": "Send Main Msg19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit15": {
      "main": [
        [
          {
            "node": "Get Msg Text19",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text19": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        [
          {
            "node": "Get Msg Text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Set Bot Info": {
      "main": [
        [
          {
            "node": "Set Session State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check User Input + Create User Prompt": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Update Session State (processing)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get msg text",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Photo2Sticker | Processing'": {
      "main": [
        []
      ]
    },
    "Send a text message1": {
      "main": [
        [
          {
            "node": "Call 'Photo2Sticker | Processing'",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (processing)": {
      "main": [
        [
          {
            "node": "Add Stickers Description And Update State (processing)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get msg text": {
      "main": [
        [
          {
            "node": "Limit16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit16": {
      "main": [
        [
          {
            "node": "Send a text message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get User1": {
      "main": [
        [
          {
            "node": "If Session Exist",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "Check User Input + Create User Prompt",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Check User Input + Create User Prompt",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Has Enough Balance?2": {
      "main": [
        [
          {
            "node": "Update Session State (wait_description)3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Update Session State (wait_buy_credit)2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (wait_description)3": {
      "main": [
        [
          {
            "node": "Get Msg Text21",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Msg Text23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text21": {
      "main": [
        [
          {
            "node": "Limit17",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit17": {
      "main": [
        [
          {
            "node": "Create Msg Text14",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text22": {
      "main": [
        [
          {
            "node": "Limit18",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Limit18": {
      "main": [
        [
          {
            "node": "Create Msg Text11",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Session State (wait_buy_credit)2": {
      "main": [
        [
          {
            "node": "Get Msg Text22",
            "type": "main",
            "index": 0
          },
          {
            "node": "Get Msg Text24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text11": {
      "main": [
        [
          {
            "node": "Send Main Msg22",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text14": {
      "main": [
        [
          {
            "node": "Send Main Msg20",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text23": {
      "main": [
        [
          {
            "node": "Create Msg Text15",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text15": {
      "main": [
        [
          {
            "node": "Send Main Msg23",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Msg Text24": {
      "main": [
        [
          {
            "node": "Create Msg Text16",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Msg Text16": {
      "main": [
        [
          {
            "node": "Send Main Msg24",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Agent Data": {
      "main": [
        [
          {
            "node": "Check User Input + Create User Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        []
      ]
    },
    "Get Bot Data": {
      "main": [
        [
          {
            "node": "Set Bot Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        []
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Structured Output Parser",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false,
    "errorWorkflow": "RvFITIrWWnckMMGs"
  },
  "versionId": "283d38f2-e9ce-449b-bee6-0e0eb9561550",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "2aba5b58948bd92d7f90b142cd7a6bc1a6cfa620e6d3bfec45ff0d7d72dee960"
  },
  "id": "lRCYg3AuIr0FBbiF",
  "tags": []
}