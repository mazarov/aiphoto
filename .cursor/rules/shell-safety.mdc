---
description: Rules for safe shell command execution to prevent system overload
alwaysApply: true
---

# Безопасная работа с Shell

## Главное правило

**ОДИН тяжёлый процесс за раз.** Никогда не запускать новый `tsc`, `npm run build`, `npm install` пока предыдущий не завершился.

## Если процесс ушёл в фон (timeout)

1. **НЕ запускать новый** — прочитать файл терминала, подождать
2. Если завис дольше 2 минут — убить: `kill <pid>`
3. Прочитать терминал ещё раз — убедиться что процесс мёртв (`exit_code` появился)
4. Только потом запускать следующую команду

## Перед запуском билда

- Убить ВСЕ фоновые процессы (dev servers, предыдущие билды)
- Убедиться что они мертвы
- Только потом запускать билд

## Git НЕ требует билда

- `git add && git commit && git push` — НЕ запускать `npm run build` перед этим
- Docker на Dockhost соберёт сам
- Билд локально — ТОЛЬКО если пользователь явно просит проверить

## Лимиты

- Максимум фоновых процессов: **1**
- Если уже есть dev server в фоне — НЕ запускать билд рядом

## Таймауты (block_until_ms)

| Команда | Таймаут |
|---------|---------|
| `tsc` / `npm run build` | 20000 |
| `npm install` | 120000 |
| `git push` | 30000 |
| dev server | 0 (сразу в фон) |
| `git add && commit` | 10000 |

## Запрещено

- ❌ Запускать несколько `tsc` / `npm` процессов параллельно
- ❌ Запускать новый процесс не убедившись что предыдущий завершился
- ❌ Игнорировать зависший процесс и запускать поверх
